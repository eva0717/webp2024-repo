<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>景點觀光展覽資訊</title>
    <style>
        /* 將 CSS 樣式放置在這裡 */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        #searchInput {
            margin-bottom: 10px;
            padding: 5px;
            width: 200px;
        }

        button {
            padding: 5px 10px;
            margin-right: 10px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }


        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            width: 33%; /* 每欄寬度為表格寬度的三分之一 */
            word-wrap: break-word; /* 文字換行 */
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #pageInfo {
            text-align: center;
            margin-top: 10px;
        }

        /* 表格表頭樣式 */
        #csie th {
            background-color: #007bff;
            color: white;
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>景點觀光展覽資訊</h1>
    <input type="text" id="searchInput" placeholder="請輸入搜尋關鍵字" onkeyup="searchByName()">
    <button onclick="prevPage()">上一頁</button>
    <button onclick="nextPage()">下一頁</button>
    <table class="table table-striped table-hover">
        <thead>
            <th>名稱</th>
            <th>地點</th>
            <th>票價</th>
        </thead>
        <tbody id="myTable">

        </tbody>
    </table>
    <table id="csie" class="table table-striped table-hover">
        
    </table>
    <p id="pageInfo"></p>
    <!-- <button onclick="delOldData()">清空資料</button> -->

    <script>
        var openUrl =
            "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6";
        var xhr = new XMLHttpRequest();
        var currentPage = 1; // 當前頁碼
        var pageSize = 10; // 每頁顯示的資料筆數
        var dataset = []; // 原始資料集
        var filteredData = []; // 搜尋後的資料集

        xhr.open('GET', openUrl, true);
        xhr.send();
        xhr.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                dataset = JSON.parse(this.responseText);
                filteredData = dataset.slice(); // 初始時搜尋資料集為完整資料集
                renderPage(currentPage);
            }
        };

        function renderPage(page) {
            var myTable = document.getElementById("myTable");
            myTable.innerHTML = ""; // 清空表格內容
            var startIndex = (page - 1) * pageSize;
            var endIndex = startIndex + pageSize;
            var pageData = filteredData.slice(startIndex, endIndex);
            pageData.forEach(function (data, index) {
                var row = myTable.insertRow(-1);
                row.insertCell(0).innerHTML = data['title'];
                row.insertCell(1).innerHTML = data['showInfo'][0]['location'];
                row.insertCell(2).innerHTML = data['showInfo'][0]['price'];
            });
            updatePageInfo(page);
        }

        // function delOldData() {
        //     var myTable = document.getElementById("csie");
        //     myTable.innerHTML = ""; // 清空表格內容
        // }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
        }

        function nextPage() {
            var totalPages = Math.ceil(filteredData.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderPage(currentPage);
            }
        }

        function updatePageInfo(page) {
            var totalPages = Math.ceil(filteredData.length / pageSize);
            document.getElementById("pageInfo").innerHTML = "目前第 " + page + " 頁，共 " + totalPages + " 頁";
        }

        function searchByName() {
            var keyword = document.getElementById("searchInput").value.trim();
            filteredData = dataset.filter(function (data) {
                return data['title'].includes(keyword);
            });
            currentPage = 1; // 搜尋後回到第一頁
            renderPage(currentPage);
        }

        updatePageInfo(currentPage);
        renderPage(currentPage);
    </script>
</body>
</html>
